#!/bin/bash
# torc-team-claim - Agent: atomically claim the next available task
# Usage: torc team claim <team-name> <agent-id>
#
# Exits 0 + prints task JSON on success.
# Exits 1 silently if no claimable tasks (all done or all blocked).

set -euo pipefail
TORC_BIN="$(cd "$(dirname "$0")" && pwd)"
source "$TORC_BIN/../lib/config.sh"
source "$TORC_BIN/../lib/tasks.sh"

TEAM_NAME="${1:-}"
AGENT_ID="${2:-}"

if [ -z "$TEAM_NAME" ] || [ -z "$AGENT_ID" ]; then
    echo "Usage: torc team claim <team-name> <agent-id>" >&2
    exit 1
fi

if [ ! -f "$(tasks_file "$TEAM_NAME")" ]; then
    echo "Error: no task list for team '$TEAM_NAME'" >&2
    exit 1
fi

tasks_claim "$TEAM_NAME" "$AGENT_ID"
